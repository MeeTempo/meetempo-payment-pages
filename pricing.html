<!DOCTYPE html>
<html lang="fr">
<head>
  <!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QJYYFST76K"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-QJYYFST76K');
</script>
<!-- Fin Google Analytics -->
  <meta charset="utf-8">
  <link rel="icon" type="image/png" href="images/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nos Offres - MeeTempo</title>
  <meta http-equiv="Content-Security-Policy" 
      content="default-src 'self'; 
               img-src https: data:; 
               script-src 'self' 'unsafe-inline'; 
               style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; 
               font-src https://fonts.gstatic.com; 
               connect-src https://api.meetempo.com https://api.stripe.com;">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --mt-dark: #030E4F;
      --mt-accent: #F49F1C;
      --mt-bg: #0a133f;
      --mt-card: #0e184f;
      --mt-text: #ffffff;
      --mt-muted: #c9d1ff;
      --ok: #23c55e;
      --err: #ef4444;
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: 'Montserrat', sans-serif;
      background: linear-gradient(160deg, #030E4F 0%, #0a133f 60%, #11183f 100%);
      color: var(--mt-text);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1100px;
      margin: 0 auto;
    }
    
    /* Header */
    .header {
      text-align: center;
      margin-bottom: 40px;
    }
    
    .logo {
      display: inline-flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }
    
    .logo-badge {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: conic-gradient(from 0deg, var(--mt-accent), #ffca63, var(--mt-accent));
      display: flex;
      align-items: center;
      justify-content: center;
      color: #111;
      font-weight: 800;
      font-size: 16px;
    }
    
    .header h1 {
      font-size: 32px;
      font-weight: 800;
      margin-bottom: 8px;
    }
    
    .header p {
      color: var(--mt-muted);
      font-size: 16px;
    }
    
    /* Plans Grid */
    .plans-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 40px;
    }
    
    @media (max-width: 1000px) {
      .plans-grid { grid-template-columns: repeat(2, 1fr); }
    }
    
    @media (max-width: 600px) {
      .plans-grid { grid-template-columns: 1fr; }
    }
    
    .plan-card {
      background: rgba(255,255,255,0.06);
      border: 2px solid rgba(255,255,255,0.12);
      border-radius: 20px;
      padding: 28px;
      position: relative;
      transition: all 0.3s;
      display: flex;
      flex-direction: column;
    }
    
    .plan-card:hover {
      transform: translateY(-8px);
      border-color: rgba(255,255,255,0.3);
      box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    }
    
    .plan-card.popular {
      border-color: var(--mt-accent);
      box-shadow: 0 0 30px rgba(244,159,28,0.2);
    }
    
    .plan-card.vip {
      border-color: #a855f7;
      background: linear-gradient(135deg, rgba(168,85,247,0.1) 0%, rgba(255,255,255,0.06) 100%);
    }
    
    .plan-card.current {
      border-color: var(--ok);
    }
    
    .badge {
      position: absolute;
      top: -12px;
      right: 20px;
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
    }
    
    .badge.popular {
      background: var(--mt-accent);
      color: #111;
    }
    
    .badge.elite {
      background: linear-gradient(135deg, #a855f7 0%, #6366f1 100%);
      color: #fff;
    }
    
    .badge.current {
      background: var(--ok);
      color: #111;
    }
    
    .plan-icon {
      font-size: 40px;
      margin-bottom: 16px;
    }
    
    .plan-name {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 8px;
    }
    
    .plan-price {
      margin-bottom: 20px;
    }
    
    .price-amount {
      font-size: 36px;
      font-weight: 800;
    }
    
    .price-period {
      font-size: 14px;
      color: var(--mt-muted);
    }
    
    .plan-features {
      list-style: none;
      margin-bottom: 24px;
      flex: 1;
    }
    
    .plan-features li {
      padding: 8px 0;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 10px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    
    .plan-features li:last-child {
      border-bottom: none;
    }
    
    .feature-icon.yes { color: var(--ok); }
    .feature-icon.no { color: var(--err); opacity: 0.5; }
    
    .plan-btn {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 12px;
      font-family: inherit;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .plan-btn.primary {
      background: var(--mt-accent);
      color: #111;
    }
    
    .plan-btn.primary:hover:not(.disabled) {
      transform: scale(1.02);
      box-shadow: 0 8px 20px rgba(244,159,28,0.4);
    }
    
    .plan-btn.vip-btn {
      background: linear-gradient(135deg, #a855f7 0%, #6366f1 100%);
      color: #fff;
    }
    
    .plan-btn.vip-btn:hover:not(.disabled) {
      box-shadow: 0 8px 20px rgba(168,85,247,0.4);
    }
    
    .plan-btn.secondary {
      background: rgba(255,255,255,0.1);
      color: var(--mt-text);
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .plan-btn.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    /* Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(4px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .modal-overlay.show {
      display: flex;
    }
    
    .modal {
      background: linear-gradient(160deg, #0e184f 0%, #0a133f 100%);
      border: 2px solid rgba(255,255,255,0.15);
      border-radius: 20px;
      padding: 32px;
      max-width: 500px;
      width: 100%;
      text-align: center;
    }
    
    .modal-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }
    
    .modal h3 {
      font-size: 22px;
      margin-bottom: 12px;
    }
    
    .modal p {
      color: var(--mt-muted);
      margin-bottom: 24px;
      line-height: 1.6;
    }
    
    .modal-actions {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .modal-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 10px;
      font-family: inherit;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .modal-btn.primary {
      background: var(--mt-accent);
      color: #111;
    }
    
    .modal-btn.vip {
      background: linear-gradient(135deg, #a855f7 0%, #6366f1 100%);
      color: #fff;
    }
    
    .modal-btn.secondary {
      background: rgba(255,255,255,0.1);
      color: var(--mt-text);
    }
    
    /* Back Button */
    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 10px;
      color: var(--mt-text);
      text-decoration: none;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s;
      margin-bottom: 20px;
    }
    
    .back-btn:hover {
      background: rgba(255,255,255,0.15);
    }
    
    /* Loading */
    .loading {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(3,14,79,0.95);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }
    
    .loading.show {
      display: flex;
    }
    
    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(255,255,255,0.1);
      border-top-color: var(--mt-accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-bottom: 16px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Info Banner */
    .info-banner {
      background: rgba(59,130,246,0.15);
      border: 1px solid rgba(59,130,246,0.3);
      border-radius: 12px;
      padding: 16px 20px;
      margin-bottom: 30px;
      text-align: center;
      font-size: 14px;
      color: #93c5fd;
    }
    
    .info-banner a {
      color: var(--mt-accent);
      text-decoration: none;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <!-- Loading -->
  <div class="loading" id="loading">
    <div class="spinner"></div>
    <div style="color: var(--mt-muted);">Redirection vers le paiement...</div>
  </div>
  
  <!-- Modal VIP -->
  <div class="modal-overlay" id="vipModal">
    <div class="modal">
      <div class="modal-icon" id="modalIcon">üëë</div>
      <h3 id="modalTitle">Offre VIP</h3>
      <p id="modalMessage">Message...</p>
      <div class="modal-actions" id="modalActions">
        <!-- Buttons inject√©s dynamiquement -->
      </div>
    </div>
  </div>
  
  <div class="container">
    <a href="#" class="back-btn" id="backBtn">‚Üê Retour au Hub</a>
    
    <div class="header">
      <div class="logo">
        <div class="logo-badge">MT</div>
        <span style="font-size: 24px; font-weight: 700;">MeeTempo</span>
      </div>
      <h1>üí´ Choisissez votre offre</h1>
      <p>Connectez-vous avec les bonnes personnes, au bon moment</p>
    </div>
    <!-- Offre Fondateur -->
<div style="background: linear-gradient(135deg, rgba(244,159,28,0.2) 0%, rgba(168,85,247,0.2) 100%); 
            border: 2px solid var(--mt-accent); 
            border-radius: 16px; 
            padding: 24px; 
            margin-bottom: 30px; 
            text-align: center;">
  <div style="font-size: 32px; margin-bottom: 12px;">üéÅ</div>
  <h2 style="font-size: 22px; font-weight: 700; margin-bottom: 8px; color: var(--mt-accent);">
    OFFRE LANCEMENT ‚Äî 3 MOIS GRATUITS
  </h2>
  <p style="color: var(--mt-muted); margin-bottom: 16px; font-size: 15px;">
    Premium ou VIP ‚Ä¢ Sans engagement ‚Ä¢ R√©siliable √† tout moment
  </p>
  <div style="display: inline-block; background: rgba(0,0,0,0.3); border: 2px dashed var(--mt-accent); 
              border-radius: 10px; padding: 12px 24px; margin-bottom: 12px;">
    <span style="color: var(--mt-muted); font-size: 13px;">Code promo √† utiliser au paiement :</span><br>
    <span style="font-size: 24px; font-weight: 800; color: var(--mt-accent); letter-spacing: 2px;">FONDATEUR3MOIS</span>
  </div>
  <p style="color: var(--mt-muted); font-size: 13px; margin-top: 8px;">
    ‚è≥ Places limit√©es : 500 Paris / 500 Londres
  </p>
</div>
        
    
    <!-- Plans Grid -->
    <div class="plans-grid" id="plansGrid">
      <!-- Cards g√©n√©r√©es par JS -->
    </div>
    
    <!-- Offre Entreprise B2B -->
    <div style="background: linear-gradient(135deg, rgba(99,102,241,0.15) 0%, rgba(168,85,247,0.15) 100%); 
                border: 2px solid rgba(99,102,241,0.3); 
                border-radius: 16px; 
                padding: 32px; 
                margin-top: 40px; 
                text-align: center;">
      <div style="font-size: 40px; margin-bottom: 16px;">üè¢</div>
      <h2 style="font-size: 24px; font-weight: 700; margin-bottom: 12px; color: #fff;">
        Offres Entreprises B2B
      </h2>
      <p style="color: var(--mt-muted); margin-bottom: 24px; font-size: 15px; line-height: 1.6;">
        √âquipez vos √©quipes avec MeeTempo : gestion centralis√©e, tarifs d√©gressifs, 
        dashboard admin, statistiques √©quipe et support d√©di√©.
      </p>
      
      <div style="display: flex; gap: 24px; justify-content: center; align-items: center; flex-wrap: wrap; margin-bottom: 24px;">
        <div style="display: flex; align-items: center; gap: 8px; color: var(--ok);">
          <span style="font-size: 24px;">‚úì</span>
          <span style="font-size: 16px;font-weight: 600;">De 12,90‚Ç¨ √† 15‚Ç¨ HT/mois selon volume</span>
        </div>
        <div style="display: flex; align-items: center; gap: 8px; color: var(--ok);">
          <span style="font-size: 24px;">‚úì</span>
          <span style="font-size: 16px;font-weight: 600;">Dashboard admin & gestion √©quipe</span>
        </div>
        <div style="display: flex; align-items: center; gap: 8px; color: var(--ok);">
          <span style="font-size: 24px;">‚úì</span>
          <span style="font-size: 16px;font-weight: 600;">Support prioritaire</span>
        </div>
      </div>
      
      <a href="login.html" 
         style="display: inline-block; 
                padding: 14px 32px; 
                background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); 
                color: #fff; 
                text-decoration: none; 
                border-radius: 12px; 
                font-weight: 700; 
                font-size: 15px;
                transition: all 0.3s;
                box-shadow: 0 4px 15px rgba(99,102,241,0.4);"
         onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 8px 25px rgba(99,102,241,0.6)';"
         onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 15px rgba(99,102,241,0.4)';">
        üöÄ Cr√©er mon entreprise
      </a>
    </div>
    
  </div>
  <!-- Footer -->
<footer style="text-align: center; padding: 40px 20px; margin-top: 40px; border-top: 1px solid rgba(255,255,255,0.1);">
  <p style="color: var(--mt-muted); font-size: 13px; margin-bottom: 8px;">
    ¬© 2025 MeeTempo ‚Äî Tous droits r√©serv√©s
  </p>
  <p style="color: rgba(255,255,255,0.4); font-size: 11px;">
    <a href="privacy.html" style="color: rgba(255,255,255,0.4); text-decoration: none;">Politique de confidentialit√©</a> 
    ‚Ä¢ 
    <a href="cgu.html" style="color: rgba(255,255,255,0.4); text-decoration: none;">CGU</a>
  </p>
</footer>  
  <script>
    const API_BASE = 'https://api.meetempo.com';
    const params = new URLSearchParams(location.search);
    const session_token = params.get('session_token') || params.get('token') || localStorage.getItem('session_token');
    
    let userData = null;
    let userPlan = 'free';
    let vipEligible = false;
    let vipScore = 0;
    let profileCompletion = 0;
    let profileComplete = false;
    let vipApplied = false;
    let vipManuallyApproved = null;
    
    // Configuration des plans
    const PLANS = [
      {
        id: 'free',
        name: 'Gratuit',
        icon: 'üÜì',
        price: '0‚Ç¨',
        period: '',
        features: [
          { text: '1 suggestion par semaine', yes: true },
          { text: 'Voir la carte', yes: true },
          { text: 'Envoyer des demandes', yes: false },
          { text: 'Messagerie', yes: false },
          { text: 'Contact autres membres', yes: false }
        ]
      },
      {
        id: 'meeting',
        name: 'Meeting',
        icon: 'ü§ù',
        price: '2,99‚Ç¨',
        period: '/ 24h',
        features: [
          { text: '3 suggestions sous 24h', yes: true },
          { text: '3 demandes sous 24h', yes: true },
          { text: 'Messagerie activ√©e', yes: true },
          { text: 'Contact : tous sauf VIP', yes: true },
          { text: 'Acc√®s espace VIP', yes: false }
        ]
      },
      {
        id: 'premium',
        name: 'Premium',
        icon: '‚≠ê',
        price: '15‚Ç¨',
        period: '/mois',
        popular: true,
        features: [
          { text: 'Suggestions illimit√©es', yes: true },
          { text: 'Demandes illimit√©es', yes: true },
          { text: 'Messagerie compl√®te', yes: true },
          { text: 'Contact : tous sauf VIP', yes: true },
          { text: 'Acc√®s espace VIP', yes: false }
        ]
      },
      {
        id: 'vip',
        name: 'VIP',
        icon: 'üëë',
        price: '29,99‚Ç¨',
        period: '/mois',
        elite: true,
        features: [
          { text: 'Tout Premium inclus', yes: true },
          { text: 'Contact TOUS les membres', yes: true },
          { text: 'Visible par tous', yes: true },
          { text: 'Espace VIP exclusif', yes: true },
          { text: 'Support prioritaire', yes: true }
        ]
      }
    ];
    
    // Niveau des plans pour comparaison
    function getPlanLevel(plan) {
      const levels = { 'free': 0, 'meeting': 1, 'premium': 2, 'vip': 3 };
      if (plan && plan.startsWith('b2b')) return 2; // B2B = niveau Premium
      return levels[plan] || 0;
    }
    
    // Init
    async function init() {
      if (!session_token) {
        window.location.href = 'login.html';
        return;
      }
      
      // Configurer bouton retour
      document.getElementById('backBtn').href = `hub.html?session_token=${session_token}`;
      
      // Charger donn√©es utilisateur
      await loadUserData();
      
      // Afficher les plans
      renderPlans();
    }
    
    async function loadUserData() {
      try {
        const response = await fetch(`${API_BASE}/profile?session_token=${session_token}`);
        
        if (!response.ok) {
          console.error('Session invalide');
          window.location.href = 'login.html';
          return;
        }
        
        userData = await response.json();
        userPlan = userData.plan || 'free';
        
        // üî• R√©cup√©rer donn√©es VIP
        vipEligible = userData.vip_eligible || false;
        vipScore = userData.vip_score || 0;
        profileCompletion = userData.profile_completion || 0;
        vipApplied = userData.vip_applied || false;
        vipManuallyApproved = userData.vip_manually_approved;

        // Profil complet = 90%+
        profileComplete = profileCompletion >= 90;

        console.log('‚úÖ Profil charg√©:', { 
          plan: userPlan, 
          vipEligible, 
          vipScore, 
          profileCompletion,
          vipApplied 
        });
        
      } catch (err) {
        console.error('Erreur chargement profil:', err);
      }
    }
    
    function renderPlans() {
      const grid = document.getElementById('plansGrid');
      
      grid.innerHTML = PLANS.map(plan => {
        const isCurrent = userPlan === plan.id;
        const isUpgrade = getPlanLevel(plan.id) > getPlanLevel(userPlan);
        const isDowngrade = getPlanLevel(plan.id) < getPlanLevel(userPlan);
        const isB2B = userPlan && userPlan.startsWith('b2b');
        
        // D√©terminer √©tat du bouton
        let btnText, btnClass, btnOnclick;
        
        if (isCurrent) {
          btnText = '‚úì Plan actuel';
          btnClass = 'plan-btn secondary disabled';
          btnOnclick = '';
        } else if (isB2B) {
          btnText = 'G√©r√© par entreprise';
          btnClass = 'plan-btn secondary disabled';
          btnOnclick = '';
        } else if (isDowngrade) {
          btnText = 'Plan inf√©rieur';
          btnClass = 'plan-btn secondary disabled';
          btnOnclick = '';
        } else if (plan.id === 'free') {
          btnText = 'Plan de base';
          btnClass = 'plan-btn secondary disabled';
          btnOnclick = '';
        } else if (plan.id === 'vip') {
          btnText = 'üëë Devenir VIP';
          btnClass = 'plan-btn vip-btn';
          btnOnclick = 'onclick="checkVipEligibility()"';
        } else {
          btnText = 'Choisir';
          btnClass = 'plan-btn primary';
          btnOnclick = `onclick="selectPlan('${plan.id}')"`;
        }
        
        // Badges
        let badgeHTML = '';
        if (isCurrent) {
          badgeHTML = '<div class="badge current">Actuel</div>';
        } else if (plan.popular) {
          badgeHTML = '<div class="badge popular">‚≠ê Populaire</div>';
        } else if (plan.elite) {
          badgeHTML = '<div class="badge elite">üëë Elite</div>';
        }
        
        // Classes de la carte
        let cardClass = 'plan-card';
        if (isCurrent) cardClass += ' current';
        if (plan.popular) cardClass += ' popular';
        if (plan.elite) cardClass += ' vip';
        
        // Features
        const featuresHTML = plan.features.map(f => `
          <li>
            <span class="feature-icon ${f.yes ? 'yes' : 'no'}">${f.yes ? '‚úì' : '‚úó'}</span>
            <span>${f.text}</span>
          </li>
        `).join('');
        
        return `
          <div class="${cardClass}">
            ${badgeHTML}
            <div class="plan-icon">${plan.icon}</div>
            <div class="plan-name">${plan.name}</div>
            <div class="plan-price">
              <span class="price-amount">${plan.price}</span>
              <span class="price-period">${plan.period}</span>
            </div>
            ${(plan.id === 'premium' || plan.id === 'vip') ? '<div style="font-size: 11px; color: #23c55e; margin-top: 4px;">‚úì Sans engagement</div>' : ''}
            <ul class="plan-features">
              ${featuresHTML}
            </ul>
            <button class="${btnClass}" ${btnOnclick}>${btnText}</button>
          </div>
        `;
      }).join('');
    }
    
    // S√©lectionner un plan (Meeting ou Premium)
    async function selectPlan(planId) {
      showLoading(true);
      
      try {
        const response = await fetch(`${API_BASE}/create-checkout-session`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            session_token: session_token,
            plan: planId,
            locale: 'fr'
          })
        });
        
        const data = await response.json();
        
        if (!response.ok) {
          throw new Error(data.error || 'Erreur cr√©ation paiement');
        }
        
        const checkoutUrl = data.checkout_url || data.url;
        if (checkoutUrl) {
          window.location.href = checkoutUrl;
        } else {
          throw new Error('URL de paiement manquante');
        }
        
      } catch (err) {
        console.error('Erreur checkout:', err);
        alert('‚ùå Erreur : ' + err.message);
        showLoading(false);
      }
    }
    
    // V√©rifier √©ligibilit√© VIP
function checkVipEligibility() {
  const modal = document.getElementById('vipModal');
  const icon = document.getElementById('modalIcon');
  const title = document.getElementById('modalTitle');
  const message = document.getElementById('modalMessage');
  const actions = document.getElementById('modalActions');
  
  // Cas 1 : Profil incomplet (< 90%)
  if (profileCompletion < 90) {
    icon.textContent = 'üìù';
    title.textContent = 'Profil incomplet';
    message.textContent = `Votre profil est √† ${profileCompletion}%. Compl√©tez-le √† 90% minimum pour candidater ou acc√©der √† l'offre VIP.`;
    actions.innerHTML = `
      <button class="modal-btn primary" onclick="goToOnboarding()">Compl√©ter mon profil</button>
      <button class="modal-btn secondary" onclick="closeModal()">Annuler</button>
    `;
  }
  // Cas 2 : √âligible automatiquement (score >= 55)
  else if (vipEligible === true) {
    icon.textContent = 'üëë';
    title.textContent = 'Bienvenue dans le club VIP !';
    message.textContent = `F√©licitations ! Votre score de ${vipScore}/100 vous rend √©ligible √† l'offre VIP. Profitez d'un acc√®s complet √† tous les membres et fonctionnalit√©s exclusives.`;
    actions.innerHTML = `
      <button class="modal-btn vip" onclick="selectPlan('vip')">Activer VIP - 29,99‚Ç¨/mois</button>
      <button class="modal-btn secondary" onclick="closeModal()">Plus tard</button>
    `;
  }
  // Cas 3 : Approuv√© manuellement par admin
  else if (vipManuallyApproved === true) {
    icon.textContent = 'üéâ';
    title.textContent = 'Candidature approuv√©e !';
    message.textContent = 'Votre candidature VIP a √©t√© approuv√©e par notre √©quipe. Vous pouvez maintenant activer votre abonnement VIP.';
    actions.innerHTML = `
      <button class="modal-btn vip" onclick="selectPlan('vip')">Activer VIP - 29,99‚Ç¨/mois</button>
      <button class="modal-btn secondary" onclick="closeModal()">Plus tard</button>
    `;
  }
  // Cas 4 : Candidature d√©j√† en cours
  else if (vipApplied === true && vipManuallyApproved === null) {
    icon.textContent = '‚è≥';
    title.textContent = 'Candidature en cours';
    message.textContent = 'Votre candidature VIP est en cours de validation par notre √©quipe (24-72h). Nous vous contacterons par email d√®s que possible.';
    actions.innerHTML = `
      <button class="modal-btn secondary" onclick="closeModal()">Compris</button>
    `;
  }
  // Cas 5 : Candidature refus√©e
  else if (vipApplied === true && vipManuallyApproved === false) {
    icon.textContent = 'üòî';
    title.textContent = 'Candidature non retenue';
    message.textContent = 'Votre candidature VIP n\'a pas √©t√© retenue cette fois. Continuez √† enrichir votre profil et r√©essayez plus tard, ou contactez notre support.';
    actions.innerHTML = `
      <button class="modal-btn primary" onclick="goToOnboarding()">Am√©liorer mon profil</button>
      <button class="modal-btn secondary" onclick="contactSupport()">Contacter le support</button>
      <button class="modal-btn secondary" onclick="closeModal()">Annuler</button>
    `;
  }
  // Cas 6 : Premium peut candidater (score < 55, profil >= 90%, pas encore candidat√©)
  else if (userPlan === 'premium' && profileCompletion >= 90) {
    icon.textContent = 'üìã';
    title.textContent = 'Candidater VIP';
    const hasLinkedin = userData.profile_rich?.linkedin ? true : false;
    const delayText = hasLinkedin ? '24h' : '48-72h';
    message.innerHTML = `
      Votre score actuel est de <strong>${vipScore}/55</strong>.<br><br>
      Vous pouvez candidater pour que notre √©quipe examine votre profil manuellement.<br>
      D√©lai de traitement : <strong>${delayText}</strong>${!hasLinkedin ? ' (plus rapide avec LinkedIn renseign√©)' : ''}.
    `;
    actions.innerHTML = `
      <textarea id="vipMotivation" placeholder="Pourquoi souhaitez-vous devenir VIP ? (optionnel)" 
        style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); 
               background: rgba(255,255,255,0.1); color: white; font-family: inherit; font-size: 14px;
               margin-bottom: 16px; min-height: 80px; resize: vertical;"></textarea>
      <button class="modal-btn vip" onclick="applyForVip()">üì® Envoyer ma candidature</button>
      <button class="modal-btn secondary" onclick="closeModal()">Annuler</button>
    `;
  }
  // Cas 7 : Non Premium, doit d'abord passer Premium
  else {
    icon.textContent = '‚≠ê';
    title.textContent = 'Passez Premium d\'abord';
    message.textContent = `L'offre VIP est r√©serv√©e aux membres Premium avec un profil valid√©. Passez Premium pour d√©bloquer la candidature VIP et profiter de toutes les fonctionnalit√©s.`;
    actions.innerHTML = `
      <button class="modal-btn primary" onclick="selectPlan('premium')">Choisir Premium - 15‚Ç¨/mois</button>
      <button class="modal-btn secondary" onclick="closeModal()">Annuler</button>
    `;
  }
  
  modal.classList.add('show');
}

// Envoyer candidature VIP
async function applyForVip() {
  const motivation = document.getElementById('vipMotivation')?.value || '';
  
  showLoading(true);
  
  try {
    const response = await fetch(`${API_BASE}/vip/apply`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        session_token: session_token,
        motivation: motivation
      })
    });
    
    const data = await response.json();
    
    showLoading(false);
    
    if (!response.ok) {
      // Afficher erreur dans modal
      const message = document.getElementById('modalMessage');
      const actions = document.getElementById('modalActions');
      
      message.innerHTML = `<span style="color: #f87171;">‚ùå ${data.error || 'Erreur lors de l\'envoi'}</span>`;
      actions.innerHTML = `
        <button class="modal-btn secondary" onclick="closeModal()">Fermer</button>
      `;
      return;
    }
    
    // Succ√®s
    const icon = document.getElementById('modalIcon');
    const title = document.getElementById('modalTitle');
    const message = document.getElementById('modalMessage');
    const actions = document.getElementById('modalActions');
    
    icon.textContent = '‚úÖ';
    title.textContent = 'Candidature envoy√©e !';
    message.innerHTML = `
      Votre candidature VIP a √©t√© envoy√©e avec succ√®s !<br><br>
      Notre √©quipe l'examinera sous <strong>${data.estimated_delay}</strong>.<br>
      Vous recevrez une r√©ponse par email.
    `;
    actions.innerHTML = `
      <button class="modal-btn primary" onclick="location.reload()">Super !</button>
    `;
    
    // Mettre √† jour √©tat local
    vipApplied = true;
    
  } catch (err) {
    console.error('Erreur candidature VIP:', err);
    showLoading(false);
    alert('‚ùå Erreur r√©seau. R√©essayez.');
  }
}
    
    function closeModal() {
      document.getElementById('vipModal').classList.remove('show');
    }
    
    function goToOnboarding() {
      window.location.href = `onboarding.html?session_token=${session_token}`;
    }
    
    function contactSupport() {
      window.location.href = 'mailto:support-VIP@meetempo.com?subject=Demande%20√©ligibilit√©%20VIP';
    }
    
    function showLoading(show) {
      document.getElementById('loading').classList.toggle('show', show);
    }
    
    // Fermer modal en cliquant √† l'ext√©rieur
    document.getElementById('vipModal').addEventListener('click', function(e) {
      if (e.target === this) closeModal();
    });
    
    // Lancer
    init();
  </script>
</body>
</html>
