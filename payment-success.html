<script>
    // R√©cup√©rer session_id depuis URL
    const urlParams = new URLSearchParams(window.location.search);
    const sessionId = urlParams.get('session_id');
    
    // Afficher session_id (debug)
    const sessionInfo = document.getElementById('sessionInfo');
    const returnBtn = document.getElementById('returnButton');
    
    if (sessionId) {
        sessionInfo.textContent = `Session: ${sessionId.substring(0, 20)}...`;
        
        // Appeler endpoint confirmation
        fetch(`https://api.meetempo.com/stripe/confirm?session_id=${sessionId}`)
            .then(r => r.json())
            .then(data => {
                console.log('Confirmation data:', data);
                
                // üî• D√âTECTER B2B
                if (data.plan && data.plan.startsWith('b2b')) {
                    // Mode B2B ‚Üí Redirection Dashboard
                    document.getElementById('message').textContent = 
                        `Votre abonnement entreprise est maintenant actif!`;
                    returnBtn.textContent = 'Acc√©der au Dashboard B2B';
                    returnBtn.href = 'https://meetempo.github.io/meetempo-payment-pages/b2b-dashboard.html';
                } else if (data.plan) {
                    // Mode B2C (Premium, VIP, Meeting)
                    const plans = {
                        premium: 'Premium',
                        vip: 'VIP',
                        meeting: 'Meeting'
                    };
                    document.getElementById('message').textContent = 
                        `Votre abonnement ${plans[data.plan]} est maintenant actif!`;
                    returnBtn.href = 'https://chatgpt.com/g/g-68f522fa42b08191978685b03a9b03c2-meetempo-test-oct19';
                } else {
                    // Fallback GPT
                    returnBtn.href = 'https://chatgpt.com/g/g-68f522fa42b08191978685b03a9b03c2-meetempo-test-oct19';
                }
            })
            .catch(err => {
                console.log('Confirmation:', err);
                // En cas d'erreur, on garde le lien GPT par d√©faut
                returnBtn.href = 'https://chatgpt.com/g/g-68f522fa42b08191978685b03a9b03c2-meetempo-test-oct19';
            });
    } else {
        // Pas de session_id ‚Üí GPT par d√©faut
        returnBtn.href = 'https://chatgpt.com/g/g-68f522fa42b08191978685b03a9b03c2-meetempo-test-oct19';
    }
</script>
